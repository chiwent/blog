<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chiwent&#39;s blog | 简单的图像处理-matlab版 | 简单的图像处理-matlab版</title>
    <meta name="description" content="">
    <link rel="icon" href="/blog/favicon.ico">
    
    <link rel="preload" href="/blog/assets/css/17.styles.16209719.css" as="style"><link rel="preload" href="/blog/assets/js/app.f602ab0d.js" as="script"><link rel="preload" href="/blog/assets/js/2.9740591e.js" as="script"><link rel="prefetch" href="/blog/assets/js/9.b6feefdb.js"><link rel="prefetch" href="/blog/assets/js/1.c5a6286d.js"><link rel="prefetch" href="/blog/assets/js/3.7d8d6283.js"><link rel="prefetch" href="/blog/assets/js/4.a375d098.js"><link rel="prefetch" href="/blog/assets/js/5.61d6a72b.js"><link rel="prefetch" href="/blog/assets/js/6.19ca0ece.js"><link rel="prefetch" href="/blog/assets/js/7.670f19f6.js"><link rel="prefetch" href="/blog/assets/js/8.7b1acf37.js"><link rel="prefetch" href="/blog/assets/js/0.600f4094.js"><link rel="prefetch" href="/blog/assets/js/10.bd8d0101.js"><link rel="prefetch" href="/blog/assets/js/11.0684896d.js"><link rel="prefetch" href="/blog/assets/js/12.c5503785.js"><link rel="prefetch" href="/blog/assets/js/13.d489fd46.js"><link rel="prefetch" href="/blog/assets/js/14.78180023.js"><link rel="prefetch" href="/blog/assets/js/15.94fb2bb1.js"><link rel="prefetch" href="/blog/assets/js/16.718066ae.js">
    <link rel="stylesheet" href="/blog/assets/css/17.styles.16209719.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="wrap"><div class="theme-container container no-sidebar"><header class="navbar"><div class="nav-header"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.jpg" class="logo"><span class="site-name can-hide">
        Chiwent's blog
      </span></a><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">HOME</a></div><div class="nav-item"><a href="https://github.com/chiwent" target="_blank" rel="noopener noreferrer" class="nav-link">GITHUB</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">About</a></div><!----></nav><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div></div></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">HOME</a></div><div class="nav-item"><a href="https://github.com/chiwent" target="_blank" rel="noopener noreferrer" class="nav-link">GITHUB</a></div><div class="nav-item"><a href="/blog/about/" class="nav-link">About</a></div><!----></nav><!----></div><div class="page-container"><div class="page card"><!----><span class="page-timestamp"></span><div class="content"><h1 id="简单的图像处理-matlab版"><a href="#简单的图像处理-matlab版" aria-hidden="true" class="header-anchor">#</a> 简单的图像处理-matlab版</h1><h2 id="查看图片的基本信息"><a href="#查看图片的基本信息" aria-hidden="true" class="header-anchor">#</a> 查看图片的基本信息</h2><p>使用到的工具箱函数有<code>imfinfo</code>，它会返回一连串的内容，有关图片的尺寸、图片类型等等。在使用的时候要注意，不能通过<code>imread</code>打开图片后直接调用它，调用它的时候需要传入文件名，而不是一个变量<br>
在所有的返回信息中，有一个最近常用到的，就是色彩信息(BitDepth)，如果是普通的彩色图，返回的是<code>unit24</code>，如果是灰度图，返回的是<code>unit8</code><br>
当然，检验图片是否是灰度图不仅是这种方法（事实上，也不推荐使用这个函数来判断是否为灰度图）<br></p><h3 id="判断一张图片是否为灰度图"><a href="#判断一张图片是否为灰度图" aria-hidden="true" class="header-anchor">#</a> 判断一张图片是否为灰度图</h3><p>可以根据用户的自己选择，有多个方法：<br></p><ul><li><p>工具箱函数
这里用到的工具箱函数有<code>isrgb(arg)</code>：假如arg是RGB图像就返回1；<code>isgray(arg)</code>：类似前面那个<br></p></li><li><p>直接判断imread返回的变量
通过<code>imread</code>读取图后，会显示读取的图像的矩阵，如果是灰度图，那么就是<code>a*b</code>，彩色图是<code>a*b*3</code><br></p></li><li><p>自定义方法</p></li></ul><pre class="language-matlab"><code>rgb<span class="token operator">=</span><span class="token function">imread</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%读入图像</span>
mysize<span class="token operator">=</span><span class="token function">size</span><span class="token punctuation">(</span>rgb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token function">numel</span><span class="token punctuation">(</span>mysize<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">2</span>
  A<span class="token operator">=</span><span class="token function">rgb2gray</span><span class="token punctuation">(</span>rgb<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%将彩色图像转换为灰度图像</span>
<span class="token keyword">else</span>
A<span class="token operator">=</span>rgb<span class="token punctuation">;</span>
<span class="token keyword">end</span>
</code></pre><p>上述内容参考自：http://www.cnblogs.com/wxl845235800/p/7488482.html<br></p><h2 id="图片的基本处理"><a href="#图片的基本处理" aria-hidden="true" class="header-anchor">#</a> 图片的基本处理</h2><h4 id="读取一张图"><a href="#读取一张图" aria-hidden="true" class="header-anchor">#</a> 读取一张图</h4><p><code>pic = imread('test.jpg')</code><br></p><h4 id="彩色图转为灰度图"><a href="#彩色图转为灰度图" aria-hidden="true" class="header-anchor">#</a> 彩色图转为灰度图</h4><ul><li><p>工具箱函数
<code>gray = rgb2gray('test.jpg')</code><br></p></li><li><p>自定义函数
彩色图转灰度图有基本的公式：<code>gray = R*0.299 + G*0.587 + B*0.114</code>，这也就是<code>rgb2gray</code>内部实现的算法。<br></p></li></ul><pre class="language-matlab"><code><span class="token keyword">function</span> gray<span class="token operator">=</span><span class="token function">rgbtogray</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>m<span class="token punctuation">,</span>n<span class="token punctuation">,</span>h<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> h <span class="token operator">==</span> <span class="token number">1</span>
    gray <span class="token operator">=</span> img<span class="token punctuation">;</span>
<span class="token keyword">end</span>

gray <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token number">i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>m
    <span class="token keyword">for</span> <span class="token number">j</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>n
        <span class="token function">gray</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">,</span><span class="token number">j</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.299</span><span class="token operator">*</span><span class="token function">img</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">,</span><span class="token number">j</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.587</span><span class="token operator">*</span><span class="token function">img</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">,</span><span class="token number">j</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.114</span><span class="token operator">*</span><span class="token function">img</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">,</span><span class="token number">j</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>
gray <span class="token operator">=</span> <span class="token function">uint8</span><span class="token punctuation">(</span>gray<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>
</code></pre><h4 id="显示直方图"><a href="#显示直方图" aria-hidden="true" class="header-anchor">#</a> 显示直方图</h4><p><code>imhist(gray)</code></p><h4 id="直方图均衡化"><a href="#直方图均衡化" aria-hidden="true" class="header-anchor">#</a> 直方图均衡化</h4><p><code>eqImage = histeq(gray)</code><br>
在这里说明一下直方图均衡化的概念<br></p><p>有一些图像的对比度不高，灰度分布不均匀，动态范围较低，这时，直方图均衡化可以使图像的灰度比较均衡，对比度能得到一定增强。
<br>
对于离散的灰度级来说，变换后的图像的灰度其实是变换前图像灰度的密度函数的累积和。这里灰度都预先归一化到范围[0-1]内。因为密度函数的累积和是一个递增的函数并且最后的值是1，所以变换前图像的灰度就被映射到[0,1]内，图像的灰度分布范围就被扩大了。<br></p><ul><li>数学原理</li></ul><p><img src="https://gitlab.com/simonid/imgWithoutBash/raw/master/imgProcess/%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E5%8C%96%E5%8E%9F%E7%90%86.png" alt="直方图均衡化原理"></p><p>上图搬运自：<a href="http://blog.sina.com.cn/s/blog_14d1511ee0102wwyt.html" target="_blank" rel="noopener noreferrer">histeq从用法到原理——Matlab直方图均衡化函数</a><br></p><h2 id="二值化"><a href="#二值化" aria-hidden="true" class="header-anchor">#</a> 二值化</h2><h3 id="阈值分割"><a href="#阈值分割" aria-hidden="true" class="header-anchor">#</a> 阈值分割</h3><p>利用图像中要提取的目标区域与其背景在灰度特性上的差异，把图像看做具有不同灰度级的两类区域（目标区域和背景区域）的组合，选取一个比较合理的阈值，以确定图像中每个像素点应该属于目标区域还是背景区域，从而产生相应的二值图像（0/1或0/255）<br></p><p>一般地，我们将感兴趣的区域或目标成为前景(foreground)，在分割后的图像中常用白色表示，其他部分成为背景(background)，用黑色表示。图像分割也可以看做是一个二值化过程<br></p><p>二值化的相关函数：<code>im2bw(gray,level)</code><br>
在做二值化之前，需要传递一个二值化的阈值参数<code>level</code>，对于这个变量<code>level</code>，我们可以通过很多方法来获取，有otsu、最大熵、迭代、自适应、手动迭代、基本全局阈值法。这里我们先介绍otsu算法。<br></p><ul><li>otsu大津法</li></ul><p>otsu的数学原理：<br>
阈值T将整幅图像分成前景和背景两部分，当两类的类间方差最大时，此时前景和背景的差别最大，二值化效果最好。因为方差是灰度分布均匀性的一种度量，当部分目标错分为背景或部分背景错分为目标都会导致两部分差别变小，因此使用类间方差最大的分割阈值意味着错分概率最小<br></p><p>otsu的局限性：<br>
它产生的是单一阈值，当物体目标与背景灰度差不明显时，会出现无法忍受的大块黑色区域，甚至丢失整幅图像的信息。
<br></p><p>otsu算法有一个固定的公式，用户可以根据公式来实现一个自定义的函数。MATLAB工具箱内有一个自动生成阈值的otsu函数，即为<code>graythresh</code>：<code>level=graythresh(gray)</code>。自动生成的阈值并不代表最优解，用户在二值化前选取阈值时，需要根据灰度直方图的波峰来判断最佳阈值。我们一般是去两个波峰之间的波谷作为阈值（im2bw要求传入的阈值是归一化的，所以在读直方图时需要将横坐标的值除以255）。假如有多个波谷，那么我们将多个波谷值作为阈值进行调试，直到测试到最佳的阈值<br></p><pre class="language-matlab"><code>level <span class="token operator">=</span> <span class="token function">graythresh</span><span class="token punctuation">(</span>gray<span class="token punctuation">)</span><span class="token punctuation">;</span>
BW <span class="token operator">=</span> <span class="token function">im2bw</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span>level<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><ul><li>局部自适应阈值分割</li></ul><p>局部自适应阈值是根据中心像素领域内像素值分布来确定像素位置上的二值化阈值。每个像素的二值化阈值不是固定不变的，而是由周围邻域像素的分布来决定的。亮度较高的图像区域的二值化阈值通常会较高，而亮度较低的图像区域的二值化阈值则会相适应地变小。不同亮度、对比度的局部图像区域将拥有相对应的局部二值化阈值。
<br></p><p>matlab的相关工具箱函数：<br><code>adaptthresh</code>:详细内容参考官方文档 - <a href="https://ww2.mathworks.cn/help/images/ref/adaptthresh.html" target="_blank" rel="noopener noreferrer">adaptthresh</a><br></p><p><code>imbinarize</code>：详细内容参考官方文档 - <a href="https://ww2.mathworks.cn/help/images/ref/imbinarize.html?requestedDomain=zh" target="_blank" rel="noopener noreferrer">imbinarize</a><br></p><p>自己实现的一个局部自适应函数：<br></p><pre class="language-matlab"><code>
<span class="token comment">% adaptivethreshold.m</span>

<span class="token comment">% from https://ww2.mathworks.cn/matlabcentral/fileexchange/8647-local-adaptive-thresholding</span>

<span class="token keyword">function</span> bw<span class="token operator">=</span><span class="token function">adaptivethreshold</span><span class="token punctuation">(</span>IM<span class="token punctuation">,</span>ws<span class="token punctuation">,</span>C<span class="token punctuation">,</span>tm<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>nargin <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'You must provide the image IM, the window size ws, and C'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">elseif</span> <span class="token punctuation">(</span>nargin <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
    tm <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">elseif</span> <span class="token punctuation">(</span>tm<span class="token operator">~=</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> tm<span class="token operator">~=</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'tm must be 0 or 1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span> 

IM <span class="token operator">=</span> <span class="token function">mat2gray</span><span class="token punctuation">(</span>IM<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> tm <span class="token operator">==</span> <span class="token number">0</span>
    mIM <span class="token operator">=</span> <span class="token function">imfilter</span><span class="token punctuation">(</span>IM<span class="token punctuation">,</span> <span class="token function">fspecial</span><span class="token punctuation">(</span><span class="token string">'average'</span><span class="token punctuation">,</span> ws<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'replicate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> 
    mIM <span class="token operator">=</span> <span class="token function">medfilt2</span><span class="token punctuation">(</span>IM<span class="token punctuation">,</span> <span class="token punctuation">[</span>ws ws<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span> 
sIM <span class="token operator">=</span> mIM <span class="token operator">-</span> IM <span class="token operator">-</span> C<span class="token punctuation">;</span>
bw <span class="token operator">=</span> <span class="token function">im2bw</span><span class="token punctuation">(</span>sIM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bw <span class="token operator">=</span> <span class="token function">imcomplement</span><span class="token punctuation">(</span>bw<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">%main.m</span>
img1 <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">'mg.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img2 <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">'mg.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bwimg1 <span class="token operator">=</span> <span class="token function">adaptivethreshold</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0.03</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">% 自己调参数</span>
bwimg2 <span class="token operator">=</span> <span class="token function">adaptivethreshold</span><span class="token punctuation">(</span>img2<span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">0.02</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">221</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">imshow</span><span class="token punctuation">(</span>img1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'im1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">imshow</span><span class="token punctuation">(</span>bwimg1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'bwimg1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">223</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">imshow</span><span class="token punctuation">(</span>img2<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'img2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">imshow</span><span class="token punctuation">(</span>bwimg2<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'bwimg2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="形态学"><a href="#形态学" aria-hidden="true" class="header-anchor">#</a> 形态学</h2><p><a href="https://www.cnblogs.com/tornadomeet/archive/2012/03/20/2408086.html" target="_blank" rel="noopener noreferrer">形态学图像处理</a><br><a href="https://ww2.mathworks.cn/help/images/morphological-filtering.html" target="_blank" rel="noopener noreferrer">mathworks - 形态学处理中常用的工具箱函数</a><br></p><h4 id="形态学处理的一些案例"><a href="#形态学处理的一些案例" aria-hidden="true" class="header-anchor">#</a> 形态学处理的一些案例</h4><p>清除图片中的混杂：https://blogs.mathworks.com/steve/2007/12/07/cleaning-up-scanned-text/<br>
取一张图片上的某些特征的文字：https://blogs.mathworks.com/steve/2008/07/14/opening-by-reconstruction/#  <br></p></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/blog/main/异步操作.html" class="prev">
          异步操作
        </a></span><span class="next"><a href="/blog/main/简单的图像处理-python实现.html">
          简单的图像处理
        </a> →
      </span></p></div></div><!----></div><div class="tool-group"><!----></div></div></div><div class="background-mask" style="background:#f6f6f6;"></div></div></div>
    <script src="/blog/assets/js/2.9740591e.js" defer></script><script src="/blog/assets/js/app.f602ab0d.js" defer></script>
  </body>
</html>
